{"remainingRequest":"D:\\ysyf\\vue-link-admin-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\ysyf\\vue-link-admin-master\\src\\views\\permission\\department.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\ysyf\\vue-link-admin-master\\src\\views\\permission\\department.vue","mtime":1581911501529},{"path":"D:\\ysyf\\vue-link-admin-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\ysyf\\vue-link-admin-master\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\ysyf\\vue-link-admin-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\ysyf\\vue-link-admin-master\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n// import the component\nimport Treeselect from '@riophae/vue-treeselect'\n// import the styles\nimport '@riophae/vue-treeselect/dist/vue-treeselect.css'\nimport permission from '@/directive/permission/index.js' // 权限判断指令\nimport {\n  departments,\n  addDpartment,\n  updateDpartment,\n  deleteDpartment\n} from '@/api/permission/department'\nimport { deepClone } from '@/utils'\nconst defaultDepartment = {\n  id: undefined,\n  name: '',\n  parentId: undefined,\n  parentName: '',\n  levels: undefined,\n  deleted: 0\n}\nexport default {\n  name: 'Department',\n  components: { Treeselect },\n  directives: { permission },\n  data() {\n    return {\n      defaultProps: {\n        children: 'childrens',\n        label: 'name'\n      },\n      department: Object.assign({}, defaultDepartment),\n      departments: [],\n      dialogVisible: false,\n      dialogType: 'new',\n      levelsOptions: [\n        { label: '集团', key: 0 },\n        { label: '分公司', key: 1 },\n        { label: '部门', key: 2 }\n      ],\n      filterText: '',\n      rules: {\n        name: [\n          { required: true, message: '请输入部门名', trigger: 'blur' },\n          { min: 2, max: 15, message: '长度在 2 到 15 个字符', trigger: 'blur' }\n        ],\n        parentId: [\n          { required: true, message: '请选择上级部门', trigger: 'change' }\n        ]\n      }\n    }\n  },\n  watch: {\n    filterText(val) {\n      this.$refs.tree.filter(val)\n    }\n  },\n  created() {\n    this.getDepartments()\n  },\n  methods: {\n    async getDepartments() {\n      const res = await departments()\n      const result = res.result\n      this.diGuiTree(result)\n      this.departments = [{ id: 0, name: '部门树', childrens: result }]\n    },\n    filterNode(value, data) {\n      if (!value) return true\n      return data.name.indexOf(value) !== -1\n    },\n    diGuiTree(item) {\n      // 递归便利树结构\n      item.forEach(item => {\n        item.childrens === '' ||\n        item.childrens === undefined ||\n        item.childrens === null\n          ? delete item.childrens\n          : this.diGuiTree(item.childrens)\n      })\n    },\n    normalizer(node) {\n      return {\n        id: node.id,\n        label: node.name,\n        children: node.childrens\n      }\n    },\n    handleCreate(data) {\n      this.dialogType = 'new'\n      this.dialogVisible = true\n      this.department = Object.assign({}, defaultDepartment)\n      if (data != null) {\n        this.department.parentId = data.id\n        this.department.parentName = data.name\n      }\n    },\n\n    async handleEdit(node, data) {\n      this.dialogType = 'edit'\n      this.dialogVisible = true\n      this.department = deepClone(data)\n      const parent = node.parent.data\n      this.department.parentId = parent.id\n      this.department.parentName = parent.name\n    },\n    async confirmDepartment() {\n      const isEdit = this.dialogType === 'edit'\n      if (isEdit) {\n        await updateDpartment(this.department)\n      } else {\n        await addDpartment(this.department)\n      }\n      this.dialogVisible = false\n      this.$message({\n        showClose: true,\n        message: '保存成功',\n        type: 'success'\n      })\n      this.getDepartments()\n    },\n    handleDelete(data) {\n      this.$confirm('确认删除?', '警告', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      })\n        .then(async() => {\n          await deleteDpartment(data.id)\n          this.$message({\n            showClose: true,\n            message: '删除成功',\n            type: 'success'\n          })\n          this.getDepartments()\n        })\n        .catch(err => {\n          console.error(err)\n        })\n    }\n  }\n}\n",null]}