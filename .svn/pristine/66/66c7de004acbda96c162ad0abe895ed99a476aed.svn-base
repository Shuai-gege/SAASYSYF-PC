{"remainingRequest":"D:\\ysyf\\iguard-vue01\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\ysyf\\iguard-vue01\\src\\views\\iguard\\tbassessconfig\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\ysyf\\iguard-vue01\\src\\views\\iguard\\tbassessconfig\\index.vue","mtime":1588122561525},{"path":"D:\\ysyf\\iguard-vue01\\node_modules\\babel-loader\\lib\\index.js","mtime":1586085013966},{"path":"D:\\ysyf\\iguard-vue01\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1586085021683},{"path":"D:\\ysyf\\iguard-vue01\\node_modules\\vue-loader\\lib\\index.js","mtime":1586085255129}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { getToken } from \"@/utils/auth\";\nimport {\n  tbassessconfiglist,\n  tbassessconfigedit,\n  tbassessconfigdelete,\n  tbassessconfigadd\n} from \"@/api/iguard/tbassessconfig/tbassessconfig\";\nimport Pagination from \"@/components/Pagination\"; // Secondary package based on el-pagination\nimport { formatTimeToStr } from \"@/utils/dateUtil\";\nimport { deepClone } from \"@/utils\";\nconst token = getToken();\nconst entityVO = {\n  vos: [\n    {\n      uid: localStorage.getItem(\"uid\"),\n      assessType: \"\",\n      proportion: \"0\"\n    }\n  ]\n};\n\nexport default {\n  name: `tbassessconfig`,\n  components: { Pagination },\n  data() {\n    return {\n      list: null,\n      listNum: [], //评价占比\n      total: 0,\n      tableKey: 0,\n      listLoading: false,\n      listQuery: {\n        page: 1,\n        limit: 10,\n        id: \"\",\n        assessType: \"\",\n        proportion: \"\",\n        createTime: \"\",\n        companyId: \"\"\n      },\n      headersObj: { \"LinkAdmin-Token\": token },\n      activeName: \"first\",\n      dialogVisibleEdit: false,\n      dialogVisibleAdd: false,\n      dialogType: \"new\",\n      entityVO: Object.assign({}, entityVO),\n      entityVO01: { vos: [] } //评论List\n    };\n  },\n  watch: {\n    searchDeptName(val) {\n      this.$refs.serchDeptTree.filter(val);\n    }\n  },\n  created() {\n    this.getList();\n  },\n  methods: {\n    async getList() {\n      this.listLoading = true;\n      // If the Promise is rejected, the rejected value is thrown.\n      try {\n        const res = await tbassessconfiglist(this.listQuery);\n        this.listLoading = false;\n        this.list = res.result.rows;\n        this.entityVO01.vos = res.result.rows;\n        this.total = res.result.records;\n        for (var i = 0; i < res.result.rows.length; i++) {\n          this.listNum.push(res.result.rows[i].proportion);\n        }\n      } catch (e) {\n        this.listLoading = false;\n      }\n    },\n    // 时间格式化\n    formatDateTime(row, column) {\n      return formatTimeToStr(row.createTime, \"yyyy-MM-dd hh:mm:ss\");\n    },\n    // 查询\n    handleSearch() {\n      this.getList();\n    },\n    // 点击编辑按钮触发\n    handleEdit(scope) {\n      this.dialogVisibleEdit = true;\n      this.entityVO = deepClone(scope.row);\n    },\n    // 点击新增按钮触发\n    handleAdd(scope) {\n      this.entityVO.assessType = \"\";\n      this.entityVO.proportion = \"\";\n      this.dialogVisibleAdd = true;\n    },\n    //判断评价占比是否超过100\n    judgeNum(arr) {\n      return eval(arr.join(\"+\"));\n    },\n\n    // 编辑功能结束，点击确定按钮触发\n    async confirmTbassessconfigEdit(obj) {\n      const res = await tbassessconfigedit(obj);\n      const result = res.code;\n      if (result == 20000) {\n        this.$message({\n          showClose: true,\n          message: \"编辑成功\",\n          type: \"success\"\n        });\n        this.dialogVisibleEdit = false;\n        this.listNum = [];\n        this.getList();\n      }\n    },\n    // 新增功能结束，点击确定按钮触发\n    async confirmTbassessconfigAdd(obj) {\n      const res = await tbassessconfigadd(obj);\n      const result = res.code;\n      if (result == 20000) {\n        this.$message({\n          showClose: true,\n          message: \"新增成功\",\n          type: \"success\"\n        });\n        this.dialogVisibleAdd = false;\n        this.getList();\n      }\n    },\n    // 点击删除按钮触发 删除生成的表的记录\n    async handleDelete(scope) {\n      const h = this.$createElement;\n      this.entityVO = deepClone(scope.row);\n      this.$msgbox({\n        title: \"删除消息\",\n        message: h(\"p\", null, [\n          h(\"span\", null, \"确定要删除 \"),\n          h(\"i\", { style: \"color: teal\" }, \"这条记录吗?\")\n        ]),\n        showCancelButton: true,\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        beforeClose: async (action, instance, done) => {\n          if (action === \"confirm\") {\n            const res = await tbassessconfigdelete(this.entityVO);\n            if (res.code == 20000) {\n              done();\n            }\n          } else {\n            done();\n          }\n        }\n      }).then(action => {\n        this.getList();\n        this.$message({\n          showClose: true,\n          type: \"success\",\n          message: \"删除成功\"\n        });\n      });\n    },\n    //批量添加\n    submitForm(formName) {\n      this.$refs[formName].validate(valid => {\n        if (valid) {\n          // this.confirmTbassessconfigAdd(this.entityVO);\n          var arrNum = [];\n          this.entityVO.vos.forEach(function(i) {\n            arrNum.push(i.proportion);\n          });\n          if (this.judgeNum(arrNum) > 100) {\n            this.$message({\n              message: \"总占比超过100，请修改。\",\n              type: \"warning\"\n            });\n          } else if (this.judgeNum(arrNum) < 100) {\n            this.$message({\n              message: \"总占比不足100，请修改。\",\n              type: \"warning\"\n            });\n          } else if (this.judgeNum(arrNum) == 100) {\n            this.confirmTbassessconfigAdd(this.entityVO);\n            setInterval(() => {\n              this.$router.go(0);\n            }, 2000);\n          }\n        } else {\n          console.log(\"error submit!!\");\n          return false;\n        }\n      });\n    },\n    // 编辑\n    submitForm1(formName) {\n      this.$refs[formName].validate(valid => {\n        if (valid) {\n          var arrNum = [];\n          this.entityVO01.vos.forEach(function(i) {\n            arrNum.push(i.proportion);\n          });\n          if (this.judgeNum(arrNum) > 100) {\n            this.$message({\n              message: \"总占比超过100，请修改。\",\n              type: \"warning\"\n            });\n          } else if (this.judgeNum(arrNum) < 100) {\n            this.$message({\n              message: \"总占比不足100，请修改。\",\n              type: \"warning\"\n            });\n          } else if (this.judgeNum(arrNum) == 100) {\n            this.confirmTbassessconfigEdit(this.entityVO01);\n            setInterval(() => {\n              this.$router.go(0);\n            }, 2000);\n          }\n        } else {\n          console.log(\"error submit!!\");\n          return false;\n        }\n      });\n    },\n    removeDomain(item) {\n      var index = this.entityVO.vos.indexOf(item);\n      if (index !== -1) {\n        this.entityVO.vos.splice(index, 1);\n      }\n    },\n    addDomain() {\n      this.entityVO.vos.push({\n        uid: localStorage.getItem(\"uid\"),\n        assessType: \"\",\n        proportion: \"0\"\n      });\n    }\n  }\n};\n",null]}